<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebJAR Demo - Embedded JavaScript Libraries</title>
    
    <!-- Bootstrap CSS from WebJAR -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.3/css/bootstrap.min.css}">
    
    <style>
        .demo-section {
            margin: 2rem 0;
            padding: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            background-color: #f8f9fa;
        }
        
        .code-block {
            background-color: #f1f3f4;
            padding: 1rem;
            border-radius: 0.25rem;
            margin: 1rem 0;
            overflow-x: auto;
        }
        
        .vulnerability-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 1rem;
            border-radius: 0.375rem;
            margin: 1rem 0;
        }
        
        .success-message {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin: 0.5rem 0;
        }
        
        .library-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="library-info text-center">
            <h1 class="mb-3">üöÄ WebJAR Demo</h1>
            <p class="lead">JavaScript libraries embedded directly in your Java JAR file!</p>
            <p class="mb-0">No external CDNs required - everything is self-contained</p>
        </div>

        <!-- jQuery Demo Section -->
        <div class="demo-section">
            <h2 class="text-primary">üìö jQuery 3.6.0 Demo</h2>
            <p>jQuery is loaded from the embedded WebJAR and ready to use:</p>
            
            <button id="jqueryTest" class="btn btn-primary me-2">Test jQuery</button>
            <button id="jqueryAnimation" class="btn btn-outline-primary">jQuery Animation</button>
            
            <div id="jqueryResult" class="mt-3"></div>
            
            <div class="code-block">
                <strong>Usage:</strong><br>
                <code>&lt;script src="/webjars/jquery/3.6.0/jquery.min.js"&gt;&lt;/script&gt;</code>
            </div>
        </div>

        <!-- Bootstrap Demo Section -->
        <div class="demo-section">
            <h2 class="text-success">üé® Bootstrap 5.1.3 Demo</h2>
            <p>Bootstrap CSS and JS are loaded from WebJARs:</p>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Bootstrap Components</h5>
                        </div>
                        <div class="card-body">
                            <p class="card-text">This entire page uses Bootstrap from the embedded WebJAR!</p>
                            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#bootstrapModal">
                                Show Modal
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="alert alert-info">
                        <h6 class="alert-heading">Bootstrap Features Working:</h6>
                        <ul class="mb-0">
                            <li>Grid System ‚úì</li>
                            <li>Components ‚úì</li>
                            <li>Utilities ‚úì</li>
                            <li>JavaScript Plugins ‚úì</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="code-block">
                <strong>Usage:</strong><br>
                <code>&lt;link rel="stylesheet" href="/webjars/bootstrap/5.1.3/css/bootstrap.min.css"&gt;</code><br>
                <code>&lt;script src="/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;</code>
            </div>
        </div>

        <!-- Lodash Demo Section -->
        <div class="demo-section">
            <h2 class="text-success">‚úÖ Lodash 4.17.21 Demo</h2>
            
            <div class="success-message">
                <strong>üîí Security Success:</strong> We tried to use vulnerable Lodash 4.17.4, but it was 
                <strong>quarantined by Sonatype</strong> repository! Now using secure version 4.17.21 instead.
                This demonstrates how modern dependency management protects against known vulnerabilities!
            </div>
            
            <p>Lodash utility library loaded from WebJAR:</p>
            
            <button id="lodashTest" class="btn btn-warning me-2">Test Lodash</button>
            <button id="lodashUtilities" class="btn btn-outline-warning">Lodash Utilities</button>
            
            <div id="lodashResult" class="mt-3"></div>
            
            <div class="code-block">
                <strong>Usage:</strong><br>
                <code>&lt;script src="/webjars/lodash/4.17.21/lodash.min.js"&gt;&lt;/script&gt;</code>
            </div>
        </div>

        <!-- API Information -->
        <div class="demo-section">
            <h2 class="text-info">üîß WebJAR API Endpoints</h2>
            <p>This JAR provides several endpoints to manage embedded JavaScript libraries:</p>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>Available Endpoints:</h5>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <strong>GET /webjars/info</strong><br>
                            <small class="text-muted">Get information about all WebJARs</small>
                        </li>
                        <li class="list-group-item">
                            <strong>GET /webjars/stats</strong><br>
                            <small class="text-muted">Get file sizes and statistics</small>
                        </li>
                        <li class="list-group-item">
                            <strong>GET /webjars/**</strong><br>
                            <small class="text-muted">Direct access to WebJAR files</small>
                        </li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Test API Endpoints:</h5>
                    <button id="testInfo" class="btn btn-info btn-sm me-2">Test /info</button>
                    <button id="testStats" class="btn btn-info btn-sm">Test /stats</button>
                    
                    <div id="apiResult" class="mt-3" style="max-height: 200px; overflow-y: auto;">
                        <small class="text-muted">Click buttons above to test API endpoints</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- AngularJS Demo Section -->
        <div class="demo-section">
            <h2 class="text-danger">üÖ∞Ô∏è AngularJS Integration</h2>
            <p>We've also embedded AngularJS 1.8.3 alongside all the other frameworks:</p>
            
            <div class="row">
                <div class="col-md-8">
                    <div class="alert alert-info">
                        <h5 class="alert-heading">üöÄ Framework Coexistence</h5>
                        <p>This JAR now contains multiple JavaScript frameworks working together:</p>
                        <ul class="mb-0">
                            <li><strong>React 17</strong> - Main application frontend</li>
                            <li><strong>AngularJS 1.8.3</strong> - Classic MVC framework demos</li>
                            <li><strong>jQuery 3.6.0</strong> - DOM manipulation and utilities</li>
                            <li><strong>Bootstrap 5.1.3</strong> - CSS framework and components</li>
                            <li><strong>Lodash 4.17.21</strong> - Utility library functions</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title text-danger">Try AngularJS Demo</h5>
                            <p class="card-text">Experience AngularJS working inside the JAR</p>
                            <a href="/webjars/angularjs-demo" class="btn btn-danger">
                                Launch AngularJS Demo ‚Üí
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Embedded JS Info -->
        <div class="demo-section">
            <h2 class="text-dark">üìä Embedded JavaScript Summary</h2>
            <div class="row">
                <div class="col-md-4 text-center">
                    <h3 class="text-primary">4</h3>
                    <p>JavaScript Libraries<br>Embedded in JAR</p>
                </div>
                <div class="col-md-4 text-center">
                    <h3 class="text-success">~600KB</h3>
                    <p>Total Size of<br>JavaScript Assets</p>
                </div>
                <div class="col-md-4 text-center">
                    <h3 class="text-info">0</h3>
                    <p>External Dependencies<br>Required at Runtime</p>
                </div>
            </div>
            
            <div class="success-message text-center">
                <strong>‚úÖ Complete Self-Contained Application:</strong> 
                All JavaScript libraries are packaged inside the JAR file. No internet connection or external CDNs required!
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center py-4 mt-5">
            <div class="border-top pt-4">
                <p class="text-muted">
                    <strong>Java + React + WebJAR Demo</strong><br>
                    Single JAR file containing Java backend, React frontend, and JavaScript libraries
                </p>
                <a href="/" class="btn btn-outline-primary btn-sm">‚Üê Back to Main App</a>
            </div>
        </footer>
    </div>

    <!-- Bootstrap Modal -->
    <div class="modal fade" id="bootstrapModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Bootstrap Modal from WebJAR</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>This modal is powered by Bootstrap JavaScript loaded from the embedded WebJAR!</p>
                    <p class="mb-0">Everything works perfectly without any external dependencies.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load JavaScript libraries from WebJARs -->
    <script th:src="@{/webjars/jquery/3.6.0/jquery.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/webjars/lodash/4.17.21/lodash.min.js}"></script>

    <script>
        $(document).ready(function() {
            // jQuery Tests
            $('#jqueryTest').click(function() {
                const version = $.fn.jquery;
                $('#jqueryResult').html(`
                    <div class="success-message">
                        <strong>‚úÖ jQuery Working!</strong><br>
                        Version: ${version}<br>
                        Library loaded from: /webjars/jquery/3.6.0/jquery.min.js
                    </div>
                `);
            });

            $('#jqueryAnimation').click(function() {
                const $result = $('#jqueryResult');
                $result.html('<div class="alert alert-info">üé¨ Watch this jQuery animation...</div>');
                
                $result.find('.alert')
                    .hide()
                    .fadeIn(1000)
                    .delay(1000)
                    .slideUp(500)
                    .queue(function() {
                        $(this).html('‚ú® jQuery animation complete!').addClass('alert-success').removeClass('alert-info');
                        $(this).dequeue();
                    })
                    .slideDown(500);
            });

            // Lodash Tests
            $('#lodashTest').click(function() {
                const version = _.VERSION;
                const testArray = [1, 2, 3, 4, 5];
                const doubled = _.map(testArray, x => x * 2);
                
                $('#lodashResult').html(`
                    <div class="success-message">
                        <strong>‚úÖ Lodash Working!</strong><br>
                        Version: ${version}<br>
                        Test: _.map([1,2,3,4,5], x => x * 2) = [${doubled.join(', ')}]<br>
                        Library loaded from: /webjars/lodash/4.17.21/lodash.min.js
                    </div>
                `);
            });

            $('#lodashUtilities').click(function() {
                const data = [
                    { name: 'Alice', age: 25, city: 'New York' },
                    { name: 'Bob', age: 30, city: 'San Francisco' },
                    { name: 'Charlie', age: 35, city: 'New York' }
                ];
                
                const grouped = _.groupBy(data, 'city');
                const names = _.map(data, 'name');
                const avgAge = _.meanBy(data, 'age');
                
                $('#lodashResult').html(`
                    <div class="success-message">
                        <strong>‚úÖ Lodash Utilities Working!</strong><br>
                        Names: ${names.join(', ')}<br>
                        Average Age: ${avgAge}<br>
                        Grouped by City: ${Object.keys(grouped).join(', ')}<br>
                        <small>Using _.groupBy, _.map, and _.meanBy functions</small>
                    </div>
                `);
            });

            // API Tests
            $('#testInfo').click(function() {
                $.get('/webjars/info')
                    .done(function(data) {
                        $('#apiResult').html(`
                            <div class="success-message">
                                <strong>‚úÖ API Response:</strong><br>
                                <pre style="font-size: 0.8rem; margin: 0.5rem 0;">${JSON.stringify(data, null, 2)}</pre>
                            </div>
                        `);
                    })
                    .fail(function() {
                        $('#apiResult').html('<div class="alert alert-danger">‚ùå API call failed</div>');
                    });
            });

            $('#testStats').click(function() {
                $.get('/webjars/stats')
                    .done(function(data) {
                        $('#apiResult').html(`
                            <div class="success-message">
                                <strong>‚úÖ Stats Response:</strong><br>
                                <pre style="font-size: 0.8rem; margin: 0.5rem 0;">${JSON.stringify(data, null, 2)}</pre>
                            </div>
                        `);
                    })
                    .fail(function() {
                        $('#apiResult').html('<div class="alert alert-danger">‚ùå API call failed</div>');
                    });
            });

            // Show success message on page load
            setTimeout(function() {
                $('body').prepend(`
                    <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin: 0; border-radius: 0;">
                        <strong>üéâ All JavaScript libraries loaded successfully from embedded WebJARs!</strong>
                        jQuery ${$.fn.jquery}, Bootstrap 5.1.3, and Lodash ${_.VERSION} are ready to use.
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `);
            }, 500);
        });
    </script>
</body>
</html>
